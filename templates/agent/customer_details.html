{% extends 'agent/base.html' %}
{% block content %}

<div class="main-content" id="mainContent">
  <div id="messageContainer"></div>

  <div class="data-container">
    <h3 style="margin-bottom:20px; font-size:1.5rem; font-weight:700; color:var(--primary-blue);">
      <i class="fas fa-user-circle" style="margin-right:10px; color:var(--primary-gold);"></i> 
      Customer Details
    </h3>

    <div class="profile-card" 
         style="background:#fff; border-radius:16px; padding:25px; box-shadow:0 4px 15px rgba(0,0,0,0.08); max-width:800px; margin:auto;">

      <div style="display:flex; align-items:center; gap:20px; margin-bottom:25px;">
        <div style="width:80px; height:80px; border-radius:50%; background:var(--primary-blue); color:#fff; 
                    font-size:2rem; display:flex; align-items:center; justify-content:center; font-weight:700;">
          {{ customer.full_name|first|upper }}
        </div>
        <div>
          <h2 style="margin:0; font-size:1.4rem; font-weight:700;">{{ customer.full_name }}</h2>
          <p style="margin:0; color:gray;">@{{ customer.user.username }}</p>
        </div>
      </div>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
        <div>
          <p><strong>Email:</strong><br><span style="color:#555;">{{ customer.user.email }}</span></p>
          <p><strong>Phone:</strong><br><span style="color:#555;">{{ customer.phone_number|default:"N/A" }}</span></p>
          <p><strong>Joined:</strong><br><span style="color:#555;">{{ customer.created_at|date:"M d, Y H:i" }}</span></p>
        </div>
        <div>
          <p><strong>Status:</strong><br>
            {% if customer.is_active %}
              <span class="status-badge status-active" 
                    style="background:#e6f9ec; color:#28a745; padding:6px 12px; border-radius:8px; font-weight:600;">
                Active
              </span>
            {% else %}
              <span class="status-badge status-inactive" 
                    style="background:#fde8e8; color:#e74c3c; padding:6px 12px; border-radius:8px; font-weight:600;">
                Inactive
              </span>
            {% endif %}
          </p>

          {% if account %}
          <p><strong>Account Number:</strong><br>
            <span style="color:#555; font-family:monospace;">{{ account.account_number }}</span>
          </p>
          <p><strong>Balance:</strong><br>
            <form method="POST" style="display:flex; align-items:center; gap:10px; margin-top:5px;">
              {% csrf_token %}
              {{ form.balance }}
              <button type="submit" class="btn-action btn-save" 
                      style="padding:6px 12px; border-radius:8px; background:var(--primary-blue); color:#fff; font-weight:600;">
                <i class="fas fa-save"></i> Update
              </button>
            </form>
          </p>
          {% endif %}
        </div>
      </div>
    </div>

    <div style="margin-top:25px; text-align:center;">
      <a href="{% url 'trade:customers' %}" 
         class="btn-action btn-back" 
         style="padding:10px 18px; border-radius:10px; background:var(--primary-blue); 
                color:#fff; text-decoration:none; font-weight:600; box-shadow:0 3px 8px rgba(0,0,0,0.1);">
        <i class="fas fa-arrow-left"></i> Back to Customers
      </a>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  {% if messages %}
    {% for message in messages %}
      const container = document.getElementById("messageContainer");
      const alertBox = document.createElement("div");
      alertBox.className = "alert-message {{ message.tags }}";
      alertBox.innerHTML = `
        <span>{{ message }}</span>
        <button style="margin-left:10px;background:none;border:none;color:inherit;cursor:pointer;font-weight:bold;">&times;</button>
      `;
      alertBox.style.padding = "12px 16px";
      alertBox.style.borderRadius = "8px";
      alertBox.style.margin = "10px 0";
      alertBox.style.display = "flex";
      alertBox.style.justifyContent = "space-between";
      alertBox.style.alignItems = "center";
      if ("{{ message.tags }}" === "success") {
        alertBox.style.background = "#d1fae5";
        alertBox.style.color = "#065f46";
      } else if ("{{ message.tags }}" === "error") {
        alertBox.style.background = "#fee2e2";
        alertBox.style.color = "#991b1b";
      } else if ("{{ message.tags }}" === "warning") {
        alertBox.style.background = "#fef3c7";
        alertBox.style.color = "#92400e";
      }
      alertBox.querySelector("button").addEventListener("click", () => {
        alertBox.remove();
      });
      container.appendChild(alertBox);
      setTimeout(() => {
        alertBox.remove();
      }, 4000);
    {% endfor %}
  {% endif %}
});
</script>

{% endblock content %}
